# Construction Timelapse Generator

The code in this project was entirely generated by ChatGPT-4, as well as (most of)
this README.

Construction Timelapse Generator is a Python script that creates timelapse videos
from a series of webcam photos taken at specified intervals. The script handles
copying photos from a source directory, processing them, and creating a high-quality
timelapse video using the powerful ffmpeg library.

## Features

- Automatically calculates sunrise and sunset times for each day based on the date
- Allows custom start and end times for each day
- Supports multiple days of photos
- Generates a 1080p, 60fps H.264 video

## Requirements

- Python 3
- ffmpeg
- rsync

## Installation

1. Clone the repository or download the script to your local machine.

```
git clone https://github.com/dag10/timelapse.git
```


2. Make sure you have Python 3, ffmpeg, and rsync installed on your system.

3. Create a virtual environment and activate it:

```
python3 -m venv venv
source venv/bin/activate
```

4. Install the required dependencies:

```
pip3 install -r requirements.txt
```

## Usage

1. Edit the script to set the source directory where your webcam photos are stored.

2. Run the script with the desired options:

```
python3 timelapse.py --date 2023-03-27 --days 1 --start 07:30 --end 19:30
```

### Command-line arguments

| Argument   | Description | Default | Format |
|------------|-------------|---------|--------|
| `--date`   | The first date to copy photos from | most recent Monday | `YYYY-MM-DD` |
| `--days`   | The number of days from the `--date` to copy photos from, inclusive | 5 | integer |
| `--start`  | The time of the first photo to copy for each day, inclusive | one hour before sunrise | 24hr format |
| `--end`    | The time of the last photo to copy for each day, inclusive | one hour after sunset | 24hr format |
| `--no-video` | If set, the script will only transfer files and not create a timelapse video | N/A | flag |
| `--no-copy`  | If set, the script will not transfer files, assuming they're already transferred | N/A | flag |
| `--no-upload` | If set, the script will not upload the video to YouTube | N/A | flag |

## To set up Youtube uploading

1. Follow the *Installation* steps to set up and enter the virtual env, with the requirements installed.

2. Go to the [Google Cloud Console](https://console.cloud.google.com/) and follow
these steps to obtain the `client_id`, `client_secret`, and `refresh_token`:

3. If you don't have a project, create a new one by clicking the "Select a project" dropdown in the top right corner and then the "New Project" button. If you already have a project, you can use it.

4. With your project selected, click on "APIs & Services" in the left-hand menu, then click on "Dashboard".

5. Click the "+ ENABLE APIS AND SERVICES" button at the top of the page.

6. In the API Library, search for "YouTube Data API v3" and click on it, then click "Enable".

7. After enabling the API, click on "Create Credentials" at the top of the page.

8. In the "Add credentials to your project" form, select "YouTube Data API v3" for "Which API are you using?", select "Other non-UI (e.g. cron job, daemon)" for "Where will you be calling the API from?", and choose "Application data" for "What data will you be accessing?". Click "What credentials do I need?".

9. Create an OAuth 2.0 client ID by giving it a name (e.g., "YouTube Uploader") and click "Create". Your client_id and client_secret will be shown. Save them for later use.

10. Click "Done".

11. On the "Credentials" page, you'll see the OAuth 2.0 Client ID you just created. Click the pencil icon to edit it.

12. Click "Download" to download the JSON file containing your client credentials. Rename this file to `client_secret.json` and move it to this project directory.

13. Now, you need to obtain the `refresh_token`. To do this, you'll need to authorize your application to access your YouTube account. Run the `get_refresh_token.py` script:

```
python4 get_refresh_token.py
```

14. A browser window should open, prompting you to sign in to your Google account and allow the application to access your YouTube account. After granting access, the script will save the refresh_token (along with client_id and client_secret) to the config.json file.

